#!/usr/bin/perl

# chmod 755 
# sudo apt-get install libdevice-serialport-perl

my $inarg = $ARGV[0] ; 
my $showIcon = $ARGV[1];

use Device::MiniLED;
use Switch;
my $sign=Device::MiniLED->new(devicetype => "sign");



if (length($inarg) > 200) {
    # a long string is probably in bits
    my $picFromBits=$sign->addPix(
	    height => 16,
	    width  => 96,
	    data   =>  "$inarg"
	);
	$sign->addMsg(
	  data => "$picFromBits",
	  effect => 'hold',
	);
} elsif ($showIcon && $showIcon != 'null') {
	@icons = (
	   "-----------XXX--" . "-----------XXX--" .
	   "------XXX-X---X-" . "------XXX-X---X-" .
	   "-XXX-X---XX----X" . "-XXX-X---XX----X" .
	   "X--XX----X-----X" . "X--XX----X-----X" .
	   "X--------------X" . "X--------------X" .
	   "X--------------X" . "X--------------X" .
	   "-X------------X-" . "-X------------X-" .
	   "--XXXXXXXXXXXX--" . "--XXXXXXXXXXXX--" .
	   "---X--------X---" . "----------------" .
	   "----X---X-------" . "----X--------X--" .
	   "---------X---X--" . "-----X---X------" .
	   "-----X--------X-" . "----------X----X" .
	   "-------X---X---X" . "------X---------" .
	   "----------------" . "--------X---X---" .
	   "----------------" . "---------X------" .
	   "----------------" . "--------------X-",
	
	   "----------------" . "----------------" .
	   "-----------XXXX-" . "-----------XXXX-" .
	   "---XXXX---X----X" . "---XXXX---X----X" .
	   "--X----X-X-----X" . "--X----X-X-----X" .
	   "-XX-----X------X" . "-XX-----X------X" .
	   "X--------------X" . "X--------------X" .
	   "X------XXXXXXXX-" . "X------XXXXXXXX-" .
	   "-XXXXXX-----X---" . "-XXXXXX-----X---" .
	   "-----X-------X--" . "-----X-------X--" .
	   "--XXX-------XXX-" . "--XXX-------XXX-" .
	   "-X-------------X" . "-X-------------X" .
	   "-X-------------X" . "-X-------------X" .
	   "--XXXXXXXXXXXXX-" . "--XXXXXXXXXXXXX-" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------",
	
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "X----X----X-----" . "X----X----X-----" .
	   "-X-------X------" . "-X-------X------" .
	   "----XXX---------" . "----XXX---------" .
	   "---X---XXXXXX---" . "---X---XXXXXX---" .
	   "--X----X-----X--" . "--X----X-----X--" .
	   "X-X--XX------X--" . "X-X--XX------X--" .
	   "--XXX-------XXX-" . "--XXX-------XXX-" .
	   "-X-------------X" . "-X-------------X" .
	   "--X------------X" . "--X------------X" .
	   "---XXXXXXXXXXXX-" . "---XXXXXXXXXXXX-" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------",
	
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------" .
	   "---X----X----X--" . "---X----X----X--" .
	   "----X-------X---" . "----X-------X---" .
	   "-------XXX------" . "-------XXX------" .
	   "------X---X-----" . "------X---X-----" .
	   "-----X-----X----" . "-----X-----X----" .
	   "--XX-X-----X-XX-" . "--XX-X-----X-XX-" .
	   "-----X-----X----" . "-----X-----X----" .
	   "------X---X-----" . "------X---X-----" .
	   "-------XXX------" . "-------XXX------" .
	   "----X------X----" . "----X------X----" .
	   "---X----X---X---" . "---X----X---X---" .
	   "----------------" . "----------------" .
	   "----------------" . "----------------");
	switch ($showIcon) {
		case "rain"			{ $iconString = @icons[0] }
		case "overcast"		{ $iconString = @icons[1] }
		case "cloudy"		{ $iconString = @icons[2] }
		case "sunny"		{ $iconString = @icons[3] }
	}
	# translate X to 1, and - to 0
	$iconString=~tr/X-/10/;
	my $icon=$sign->addIcon(
		data => $iconString
	);
	$sign->addMsg(
		data => "$inarg $icon",
		effect => 'hold',
	);
} else {
	$sign->addMsg(
	  data => "$inarg",
	  effect => 'scroll',
	);
}


$sign->send(device => "/dev/ttyUSB0");